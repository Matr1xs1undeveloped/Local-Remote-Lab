<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>

<style>
body { 
    background: url("/static/background/coolbackgrounds-particles-compute.png") no-repeat center center fixed;
    background-size: cover;
    color: #b19cd9;
    font-family: monospace;
    margin: 0;
}

.main-container {
    display: flex;
    gap: 20px;
    padding: 20px;
}

.left-panel {
    position: sticky;
    top: 20px;
}

.right-panel {
    flex: 1;
}

.screen-container {
    width: 640px;
    height: 360px;
    border: 2px solid #b19cd9;
    overflow: hidden;
    background: rgba(0,0,0,0.7);
    border-radius: 8px;
}

.screen-container img {
    width: 100%;
}

.subsection {
    margin-top: 20px;
}

button {
    margin: 5px;
    padding: 10px 20px;
    background: rgba(0,0,0,0.5);
    color: #b19cd9;
    border: 1px solid #b19cd9;
    border-radius: 5px;
    cursor: pointer;
}
button:hover {
    background: #b19cd9;
    color: #111;
}

input {
    margin: 5px;
    padding: 5px;
    background: rgba(0,0,0,0.5);
    color: #b19cd9;
    border: 1px solid #b19cd9;
    border-radius: 5px;
}

.keyboard {
    display: grid;
    grid-template-columns: repeat(14, 40px);
    gap: 3px;
}

.key {
    width: 38px;
    height: 38px;
    border: 1px solid #b19cd9;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}
.key:hover {
    background: #b19cd9;
    color: #111;
}

.mouse-area {
    width: 480px;
    height: 270px;
    border: 2px solid #b19cd9;
    background: rgba(0,0,0,0.7);
    position: relative;
    cursor: crosshair;
}

.pointer {
    width: 10px;
    height: 10px;
    background: #b19cd9;
    border-radius: 50%;
    position: absolute;
}
</style>
</head>

<body>

<div class="main-container">

<div class="left-panel">
    <h1>Local Remote Lab</h1>
    <div class="screen-container">
        <img id="screen" src="/static/screen.png">
    </div>
</div>

<div class="right-panel">

<div class="subsection">
<h2>Remote Actions</h2>

<form action="/create_folder" method="post">
<input name="folder_name" placeholder="Folder name">
<button>Create Folder</button>
</form>

<form action="/shutdown" method="post" onsubmit="return confirm('Shutdown PC?')">
<button>Shutdown</button>
</form>

<form action="/delete_file" method="post">
<input name="file_name" placeholder="File name">
<button>Delete</button>
</form>

<form action="/overlay" method="post">
<input name="overlay_text" placeholder="Overlay text">
<button>Overlay</button>
</form>

<form action="/list_processes" method="get">
<button>Processes</button>
</form>

<p>CPU: {{ cpu }}% | RAM: {{ ram }}%</p>
</div>

<div class="subsection" id="keyboardSection">
<h2>Virtual Keyboard (Mobile)</h2>
<div class="keyboard" id="keyboard"></div>
</div>

<div class="subsection">
<h2>Remote Mouse control</h2>
<div class="mouse-area" id="mouseArea">
<div class="pointer" id="pointer"></div>
</div>
</div>

</div>
</div>

<script>
const img = document.getElementById("screen");
setInterval(() => {
    img.src = "/static/screen.png?" + Date.now();
}, 200);

function isMobile() {
    return /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
}

const keys = [
"Esc","1","2","3","4","5","6","7","8","9","0",
"Q","W","E","R","T","Y","U","I","O","P",
"A","S","D","F","G","H","J","K","L",
"Z","X","C","V","B","N","M","Space","Enter","Backspace"
];

const keyboardDiv = document.getElementById("keyboard");

if (isMobile()) {
    keys.forEach(k => {
        const d = document.createElement("div");
        d.className = "key";
        d.innerText = k;
        d.onclick = () => sendKey(k);
        keyboardDiv.appendChild(d);
    });
} else {
    document.getElementById("keyboardSection").style.display = "none";
}

if (!isMobile()) {
    document.addEventListener("keydown", e => {
        e.preventDefault();
        sendKey(e.key);
    });
}

function sendKey(key) {
    fetch("/send_key", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ key })
    });
}

const mouseArea = document.getElementById("mouseArea");
const pointer = document.getElementById("pointer");

mouseArea.addEventListener("mousemove", e => {
    const r = mouseArea.getBoundingClientRect();
    const x = e.clientX - r.left;
    const y = e.clientY - r.top;

    pointer.style.left = x + "px";
    pointer.style.top = y + "px";

    fetch("/mouse_move", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({ x, y })
    });
});

mouseArea.addEventListener("mousedown", e => {
    fetch("/mouse_click", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({ button: e.button })
    });
});
</script>

</body>
</html>
